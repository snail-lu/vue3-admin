import{b as q,d as g,a as V,u as I,k as R,c8 as ge,c9 as re,bj as he,b_ as ie,b5 as ue,a9 as be,a2 as ee,o as v,c as C,n as m,e,g as B,h as A,r as T,t as H,f as k,q as D,s as S,v as ke,ax as j,_ as W,w as de,ab as x,bJ as $e,m as Q,c1 as P,az as we,C as K,as as _e,aE as ce,z as F,ca as Ee,b6 as M,cb as Ce,cc as Se,ag as pe,cd as Pe,a1 as Re,j as Te,b9 as Y,ce as Ue,cf as Fe,a5 as te,a6 as Le,ai as De,bM as Oe,ad as Be,x as Ne,bT as je,bl as se,at as Z,D as Ae,cg as Ie}from"./index.cfe6ee68.js";import{E as Me}from"./el-dialog.c72242cb.js";const fe=Symbol("uploadContextKey"),qe=q({type:{type:String,default:"line",values:["line","circle","dashboard"]},percentage:{type:Number,default:0,validator:a=>a>=0&&a<=100},status:{type:String,default:"",values:["","success","exception","warning"]},indeterminate:{type:Boolean,default:!1},duration:{type:Number,default:3},strokeWidth:{type:Number,default:6},strokeLinecap:{type:g(String),default:"round"},textInside:{type:Boolean,default:!1},width:{type:Number,default:126},showText:{type:Boolean,default:!0},color:{type:g([String,Array,Function]),default:""},format:{type:g(Function),default:a=>`${a}%`}}),Ve=["aria-valuenow"],ze={viewBox:"0 0 100 100"},We=["d","stroke","stroke-width"],He=["d","stroke","opacity","stroke-linecap","stroke-width"],Ke={key:0},Xe={name:"ElProgress"},Je=V({...Xe,props:qe,setup(a){const s=a,n={success:"#13ce66",exception:"#ff4949",warning:"#e6a23c",default:"#20a0ff"},l=I("progress"),c=R(()=>({width:`${s.percentage}%`,animationDuration:`${s.duration}s`,backgroundColor:E(s.percentage)})),d=R(()=>(s.strokeWidth/s.width*100).toFixed(1)),f=R(()=>["circle","dashboard"].includes(s.type)?Number.parseInt(`${50-Number.parseFloat(d.value)/2}`,10):0),h=R(()=>{const i=f.value,U=s.type==="dashboard";return`
          M 50 50
          m 0 ${U?"":"-"}${i}
          a ${i} ${i} 0 1 1 0 ${U?"-":""}${i*2}
          a ${i} ${i} 0 1 1 0 ${U?"":"-"}${i*2}
          `}),$=R(()=>2*Math.PI*f.value),w=R(()=>s.type==="dashboard"?.75:1),u=R(()=>`${-1*$.value*(1-w.value)/2}px`),_=R(()=>({strokeDasharray:`${$.value*w.value}px, ${$.value}px`,strokeDashoffset:u.value})),o=R(()=>({strokeDasharray:`${$.value*w.value*(s.percentage/100)}px, ${$.value}px`,strokeDashoffset:u.value,transition:"stroke-dasharray 0.6s ease 0s, stroke 0.6s ease, opacity ease 0.6s"})),t=R(()=>{let i;return s.color?i=E(s.percentage):i=n[s.status]||n.default,i}),r=R(()=>s.status==="warning"?ge:s.type==="line"?s.status==="success"?re:he:s.status==="success"?ie:ue),y=R(()=>s.type==="line"?12+s.strokeWidth*.4:s.width*.111111+2),b=R(()=>s.format(s.percentage));function p(i){const U=100/i.length;return i.map((O,N)=>ee(O)?{color:O,percentage:(N+1)*U}:O).sort((O,N)=>O.percentage-N.percentage)}const E=i=>{var U;const{color:L}=s;if(be(L))return L(i);if(ee(L))return L;{const O=p(L);for(const N of O)if(N.percentage>i)return N.color;return(U=O[O.length-1])==null?void 0:U.color}};return(i,U)=>(v(),C("div",{class:m([e(l).b(),e(l).m(i.type),e(l).is(i.status),{[e(l).m("without-text")]:!i.showText,[e(l).m("text-inside")]:i.textInside}]),role:"progressbar","aria-valuenow":i.percentage,"aria-valuemin":"0","aria-valuemax":"100"},[i.type==="line"?(v(),C("div",{key:0,class:m(e(l).b("bar"))},[B("div",{class:m(e(l).be("bar","outer")),style:A({height:`${i.strokeWidth}px`})},[B("div",{class:m([e(l).be("bar","inner"),{[e(l).bem("bar","inner","indeterminate")]:i.indeterminate}]),style:A(e(c))},[(i.showText||i.$slots.default)&&i.textInside?(v(),C("div",{key:0,class:m(e(l).be("bar","innerText"))},[T(i.$slots,"default",{percentage:i.percentage},()=>[B("span",null,H(e(b)),1)])],2)):k("v-if",!0)],6)],6)],2)):(v(),C("div",{key:1,class:m(e(l).b("circle")),style:A({height:`${i.width}px`,width:`${i.width}px`})},[(v(),C("svg",ze,[B("path",{class:m(e(l).be("circle","track")),d:e(h),stroke:`var(${e(l).cssVarName("fill-color-light")}, #e5e9f2)`,"stroke-width":e(d),fill:"none",style:A(e(_))},null,14,We),B("path",{class:m(e(l).be("circle","path")),d:e(h),stroke:e(t),fill:"none",opacity:i.percentage?1:0,"stroke-linecap":i.strokeLinecap,"stroke-width":e(d),style:A(e(o))},null,14,He)]))],6)),(i.showText||i.$slots.default)&&!i.textInside?(v(),C("div",{key:2,class:m(e(l).e("text")),style:A({fontSize:`${e(y)}px`})},[T(i.$slots,"default",{percentage:i.percentage},()=>[i.status?(v(),D(e(j),{key:1},{default:S(()=>[(v(),D(ke(e(r))))]),_:1})):(v(),C("span",Ke,H(e(b)),1))])],6)):k("v-if",!0)],10,Ve))}});var Ge=W(Je,[["__file","/home/runner/work/element-plus/element-plus/packages/components/progress/src/progress.vue"]]);const Qe=de(Ge),Ye="ElUpload";class Ze extends Error{constructor(s,n,l,c){super(s),this.name="UploadAjaxError",this.status=n,this.method=l,this.url=c}}function ae(a,s,n){let l;return n.response?l=`${n.response.error||n.response}`:n.responseText?l=`${n.responseText}`:l=`fail to ${s.method} ${a} ${n.status}`,new Ze(l,n.status,s.method,a)}function xe(a){const s=a.responseText||a.response;if(!s)return s;try{return JSON.parse(s)}catch{return s}}const et=a=>{typeof XMLHttpRequest>"u"&&x(Ye,"XMLHttpRequest is undefined");const s=new XMLHttpRequest,n=a.action;s.upload&&s.upload.addEventListener("progress",d=>{const f=d;f.percent=d.total>0?d.loaded/d.total*100:0,a.onProgress(f)});const l=new FormData;if(a.data)for(const[d,f]of Object.entries(a.data))Array.isArray(f)?l.append(d,...f):l.append(d,f);l.append(a.filename,a.file,a.file.name),s.addEventListener("error",()=>{a.onError(ae(n,a,s))}),s.addEventListener("load",()=>{if(s.status<200||s.status>=300)return a.onError(ae(n,a,s));a.onSuccess(xe(s))}),s.open(a.method,n,!0),a.withCredentials&&"withCredentials"in s&&(s.withCredentials=!0);const c=a.headers||{};if(c instanceof Headers)c.forEach((d,f)=>s.setRequestHeader(f,d));else for(const[d,f]of Object.entries(c))$e(f)||s.setRequestHeader(d,String(f));return s.send(l),s},ve=["text","picture","picture-card"];let tt=1;const me=()=>Date.now()+tt++,ye=q({action:{type:String,default:"#"},headers:{type:g(Object)},method:{type:String,default:"post"},data:{type:Object,default:()=>Q({})},multiple:{type:Boolean,default:!1},name:{type:String,default:"file"},drag:{type:Boolean,default:!1},withCredentials:Boolean,showFileList:{type:Boolean,default:!0},accept:{type:String,default:""},type:{type:String,default:"select"},fileList:{type:g(Array),default:()=>Q([])},autoUpload:{type:Boolean,default:!0},listType:{type:String,values:ve,default:"text"},httpRequest:{type:g(Function),default:et},disabled:Boolean,limit:Number}),st=q({...ye,beforeUpload:{type:g(Function),default:P},beforeRemove:{type:g(Function)},onRemove:{type:g(Function),default:P},onChange:{type:g(Function),default:P},onPreview:{type:g(Function),default:P},onSuccess:{type:g(Function),default:P},onProgress:{type:g(Function),default:P},onError:{type:g(Function),default:P},onExceed:{type:g(Function),default:P}}),at=q({files:{type:g(Array),default:()=>Q([])},disabled:{type:Boolean,default:!1},handlePreview:{type:g(Function),default:P},listType:{type:String,values:ve,default:"text"}}),ot={remove:a=>!!a},nt=["onKeydown"],lt=["src"],rt=["onClick"],it=["onClick"],ut=["onClick"],dt={name:"ElUploadList"},ct=V({...dt,props:at,emits:ot,setup(a,{emit:s}){const n=a,{t:l}=we(),c=I("upload"),d=I("icon"),f=I("list"),h=K(!1),$=u=>{n.handlePreview(u)},w=u=>{s("remove",u)};return(u,_)=>(v(),D(Pe,{tag:"ul",class:m([e(c).b("list"),e(c).bm("list",u.listType),e(c).is("disabled",u.disabled)]),name:e(f).b()},{default:S(()=>[(v(!0),C(pe,null,_e(u.files,o=>(v(),C("li",{key:o.uid||o.name,class:m([e(c).be("list","item"),e(c).is(o.status),{focusing:h.value}]),tabindex:"0",onKeydown:ce(t=>!u.disabled&&w(o),["delete"]),onFocus:_[0]||(_[0]=t=>h.value=!0),onBlur:_[1]||(_[1]=t=>h.value=!1),onClick:_[2]||(_[2]=t=>h.value=!1)},[T(u.$slots,"default",{file:o},()=>[u.listType==="picture"||o.status!=="uploading"&&u.listType==="picture-card"?(v(),C("img",{key:0,class:m(e(c).be("list","item-thumbnail")),src:o.url,alt:""},null,10,lt)):k("v-if",!0),u.listType!=="picture"&&(o.status==="uploading"||u.listType!=="picture-card")?(v(),C("div",{key:1,class:m(e(c).be("list","item-info"))},[B("a",{class:m(e(c).be("list","item-name")),onClick:M(t=>$(o),["prevent"])},[F(e(j),{class:m(e(d).m("document"))},{default:S(()=>[F(e(Ee))]),_:1},8,["class"]),B("span",{class:m(e(c).be("list","item-file-name"))},H(o.name),3)],10,rt),o.status==="uploading"?(v(),D(e(Qe),{key:0,type:u.listType==="picture-card"?"circle":"line","stroke-width":u.listType==="picture-card"?6:2,percentage:Number(o.percentage),style:A(u.listType==="picture-card"?"":"margin-top: 0.5rem")},null,8,["type","stroke-width","percentage","style"])):k("v-if",!0)],2)):k("v-if",!0),B("label",{class:m(e(c).be("list","item-status-label"))},[u.listType==="text"?(v(),D(e(j),{key:0,class:m([e(d).m("upload-success"),e(d).m("circle-check")])},{default:S(()=>[F(e(re))]),_:1},8,["class"])):["picture-card","picture"].includes(u.listType)?(v(),D(e(j),{key:1,class:m([e(d).m("upload-success"),e(d).m("check")])},{default:S(()=>[F(e(ie))]),_:1},8,["class"])):k("v-if",!0)],2),u.disabled?k("v-if",!0):(v(),D(e(j),{key:2,class:m(e(d).m("close")),onClick:t=>w(o)},{default:S(()=>[F(e(ue))]),_:2},1032,["class","onClick"])),k(" Due to close btn only appears when li gets focused disappears after li gets blurred, thus keyboard navigation can never reach close btn"),k(" This is a bug which needs to be fixed "),k(" TODO: Fix the incorrect navigation interaction "),u.disabled?k("v-if",!0):(v(),C("i",{key:3,class:m(e(d).m("close-tip"))},H(e(l)("el.upload.deleteTip")),3)),u.listType==="picture-card"?(v(),C("span",{key:4,class:m(e(c).be("list","item-actions"))},[B("span",{class:m(e(c).be("list","item-preview")),onClick:t=>u.handlePreview(o)},[F(e(j),{class:m(e(d).m("zoom-in"))},{default:S(()=>[F(e(Ce))]),_:1},8,["class"])],10,it),u.disabled?k("v-if",!0):(v(),C("span",{key:0,class:m(e(c).be("list","item-delete")),onClick:t=>w(o)},[F(e(j),{class:m(e(d).m("delete"))},{default:S(()=>[F(e(Se))]),_:1},8,["class"])],10,ut))],2)):k("v-if",!0)])],42,nt))),128)),T(u.$slots,"append")]),_:3},8,["class","name"]))}});var oe=W(ct,[["__file","/home/runner/work/element-plus/element-plus/packages/components/upload/src/upload-list.vue"]]);const pt=q({disabled:{type:Boolean,default:!1}}),ft={file:a=>Re(a)},vt=["onDrop","onDragover"],mt={name:"ElUploadDrag"},yt=V({...mt,props:pt,emits:ft,setup(a,{emit:s}){const n=a,l="ElUploadDrag",c=Te(fe);c||x(l,"usage: <el-upload><el-upload-dragger /></el-upload>");const d=I("upload"),f=K(!1),h=w=>{if(n.disabled)return;f.value=!1;const u=Array.from(w.dataTransfer.files),_=c.accept.value;if(!_){s("file",u);return}const o=u.filter(t=>{const{type:r,name:y}=t,b=y.includes(".")?`.${y.split(".").pop()}`:"",p=r.replace(/\/.*$/,"");return _.split(",").map(E=>E.trim()).filter(E=>E).some(E=>E.startsWith(".")?b===E:/\/\*$/.test(E)?p===E.replace(/\/\*$/,""):/^[^/]+\/[^/]+$/.test(E)?r===E:!1)});s("file",o)},$=()=>{n.disabled||(f.value=!0)};return(w,u)=>(v(),C("div",{class:m([e(d).b("dragger"),e(d).is("dragover",f.value)]),onDrop:M(h,["prevent"]),onDragover:M($,["prevent"]),onDragleave:u[0]||(u[0]=M(_=>f.value=!1,["prevent"]))},[T(w.$slots,"default")],42,vt))}});var gt=W(yt,[["__file","/home/runner/work/element-plus/element-plus/packages/components/upload/src/upload-dragger.vue"]]);const ht=q({...ye,beforeUpload:{type:g(Function),default:P},onRemove:{type:g(Function),default:P},onStart:{type:g(Function),default:P},onSuccess:{type:g(Function),default:P},onProgress:{type:g(Function),default:P},onError:{type:g(Function),default:P},onExceed:{type:g(Function),default:P}}),bt=["onKeydown"],kt=["name","multiple","accept"],$t={name:"ElUploadContent",inheritAttrs:!1},wt=V({...$t,props:ht,setup(a,{expose:s}){const n=a,l=I("upload"),c=Y({}),d=Y(),f=t=>{if(t.length===0)return;const{autoUpload:r,limit:y,fileList:b,multiple:p,onStart:E,onExceed:i}=n;if(y&&b.length+t.length>y){i(t,b);return}p||(t=t.slice(0,1));for(const U of t){const L=U;L.uid=me(),E(L),r&&h(L)}},h=async t=>{if(d.value.value="",!n.beforeUpload)return $(t);let r;try{r=await n.beforeUpload(t)}catch{r=!1}if(r===!1){n.onRemove(t);return}let y=t;r instanceof Blob&&(r instanceof File?y=r:y=new File([r],t.name,{type:t.type})),$(Object.assign(y,{uid:t.uid}))},$=t=>{const{headers:r,data:y,method:b,withCredentials:p,name:E,action:i,onProgress:U,onSuccess:L,onError:O,httpRequest:N}=n,{uid:X}=t,J={headers:r||{},withCredentials:p,file:t,data:y,method:b,filename:E,action:i,onProgress:z=>{U(z,t)},onSuccess:z=>{L(z,t),delete c.value[X]},onError:z=>{O(z,t),delete c.value[X]}},G=N(J);c.value[X]=G,G instanceof Promise&&G.then(J.onSuccess,J.onError)},w=t=>{const r=t.target.files;!r||f(Array.from(r))},u=()=>{n.disabled||(d.value.value="",d.value.click())},_=()=>{u()};return s({abort:t=>{Ue(c.value).filter(t?([y])=>String(t.uid)===y:()=>!0).forEach(([y,b])=>{b instanceof XMLHttpRequest&&b.abort(),delete c.value[y]})},upload:h}),(t,r)=>(v(),C("div",{class:m([e(l).b(),e(l).m(t.listType),e(l).is("drag",t.drag)]),tabindex:"0",onClick:u,onKeydown:ce(M(_,["self"]),["enter","space"])},[t.drag?(v(),D(gt,{key:0,disabled:t.disabled,onFile:f},{default:S(()=>[T(t.$slots,"default")]),_:3},8,["disabled"])):T(t.$slots,"default",{key:1}),B("input",{ref_key:"inputRef",ref:d,class:m(e(l).e("input")),name:t.name,multiple:t.multiple,accept:t.accept,type:"file",onChange:w,onClick:r[0]||(r[0]=M(()=>{},["stop"]))},null,42,kt)],42,bt))}});var ne=W(wt,[["__file","/home/runner/work/element-plus/element-plus/packages/components/upload/src/upload-content.vue"]]);const le="ElUpload",_t=a=>{var s;(s=a.url)!=null&&s.startsWith("blob:")&&URL.revokeObjectURL(a.url)},Et=(a,s)=>{const n=Fe(a,"fileList",void 0,{passive:!0}),l=o=>n.value.find(t=>t.uid===o.uid);function c(o){var t;(t=s.value)==null||t.abort(o)}function d(o=["ready","uploading","success","fail"]){n.value=n.value.filter(t=>!o.includes(t.status))}const f=(o,t)=>{const r=l(t);!r||(console.error(o),r.status="fail",n.value.splice(n.value.indexOf(r),1),a.onError(o,r,n.value),a.onChange(r,n.value))},h=(o,t)=>{const r=l(t);!r||(a.onProgress(o,r,n.value),r.status="uploading",r.percentage=Math.round(o.percent))},$=(o,t)=>{const r=l(t);!r||(r.status="success",r.response=o,a.onSuccess(o,r,n.value),a.onChange(r,n.value))},w=o=>{const t={name:o.name,percentage:0,status:"ready",size:o.size,raw:o,uid:o.uid};if(a.listType==="picture-card"||a.listType==="picture")try{t.url=URL.createObjectURL(o)}catch(r){Le(le,r.message),a.onError(r,t,n.value)}n.value.push(t),a.onChange(t,n.value)},u=async o=>{const t=o instanceof File?l(o):o;t||x(le,"file to be removed not found");const r=y=>{c(y);const b=n.value;b.splice(b.indexOf(y),1),a.onRemove(y,b),_t(y)};a.beforeRemove?await a.beforeRemove(t,n.value)!==!1&&r(t):r(t)};function _(){n.value.filter(({status:o})=>o==="ready").forEach(({raw:o})=>{var t;return o&&((t=s.value)==null?void 0:t.upload(o))})}return te(()=>a.listType,o=>{o!=="picture-card"&&o!=="picture"||(n.value=n.value.map(t=>{const{raw:r,url:y}=t;if(!y&&r)try{t.url=URL.createObjectURL(r)}catch(b){a.onError(b,t,n.value)}return t}))}),te(n,o=>{for(const t of o)t.uid||(t.uid=me()),t.status||(t.status="success")},{immediate:!0,deep:!0}),{uploadFiles:n,abort:c,clearFiles:d,handleError:f,handleProgress:h,handleStart:w,handleSuccess:$,handleRemove:u,submit:_}},Ct={name:"ElUpload"},St=V({...Ct,props:st,setup(a,{expose:s}){const n=a,l=De(),c=Oe(),d=Y(),{abort:f,submit:h,clearFiles:$,uploadFiles:w,handleStart:u,handleError:_,handleRemove:o,handleSuccess:t,handleProgress:r}=Et(n,d),y=R(()=>n.listType==="picture-card"),b=R(()=>({...n,onStart:u,onProgress:r,onSuccess:t,onError:_,onRemove:o}));return Be(()=>{w.value.forEach(({url:p})=>{p!=null&&p.startsWith("blob:")&&URL.revokeObjectURL(p)})}),Ne(fe,{accept:je(n,"accept")}),s({abort:f,submit:h,clearFiles:$,handleStart:u,handleRemove:o}),(p,E)=>(v(),C("div",null,[e(y)&&p.showFileList?(v(),D(oe,{key:0,disabled:e(c),"list-type":p.listType,files:e(w),"handle-preview":p.onPreview,onRemove:e(o)},se({append:S(()=>[p.listType==="picture-card"?(v(),D(ne,Z({key:0,ref_key:"uploadRef",ref:d},e(b)),{default:S(()=>[e(l).trigger?T(p.$slots,"trigger",{key:0}):k("v-if",!0),!e(l).trigger&&e(l).default?T(p.$slots,"default",{key:1}):k("v-if",!0)]),_:3},16)):k("v-if",!0)]),_:2},[p.$slots.file?{name:"default",fn:S(({file:i})=>[T(p.$slots,"file",{file:i})])}:void 0]),1032,["disabled","list-type","files","handle-preview","onRemove"])):k("v-if",!0),p.listType!=="picture-card"?(v(),D(ne,Z({key:1,ref_key:"uploadRef",ref:d},e(b)),{default:S(()=>[e(l).trigger?T(p.$slots,"trigger",{key:0}):k("v-if",!0),!e(l).trigger&&e(l).default?T(p.$slots,"default",{key:1}):k("v-if",!0)]),_:3},16)):k("v-if",!0),p.$slots.trigger?T(p.$slots,"default",{key:2}):k("v-if",!0),T(p.$slots,"tip"),!e(y)&&p.showFileList?(v(),D(oe,{key:3,disabled:e(c),"list-type":p.listType,files:e(w),"handle-preview":p.onPreview,onRemove:e(o)},se({_:2},[p.$slots.file?{name:"default",fn:S(({file:i})=>[T(p.$slots,"file",{file:i})])}:void 0]),1032,["disabled","list-type","files","handle-preview","onRemove"])):k("v-if",!0)]))}});var Pt=W(St,[["__file","/home/runner/work/element-plus/element-plus/packages/components/upload/src/upload.vue"]]);const Rt=de(Pt);const Tt=["src"],Lt=V({__name:"Uploader",props:{modelValue:{type:Array,default:[]}},setup(a){const n=Ae(a.modelValue),l=K(""),c=K(!1),d=(h,$)=>{console.log(h,$)},f=h=>{l.value=h.url,c.value=!0};return(h,$)=>{const w=j,u=Rt,_=Me;return v(),C(pe,null,[F(u,Z({"file-list":n,"on-preview":f,"on-remove":d},h.$attrs),{default:S(()=>[F(w,null,{default:S(()=>[F(e(Ie))]),_:1})]),_:1},16,["file-list"]),F(_,{modelValue:c.value,"onUpdate:modelValue":$[0]||($[0]=o=>c.value=o)},{default:S(()=>[B("img",{"w-full":"",src:l.value,alt:"Preview Image"},null,8,Tt)]),_:1},8,["modelValue"])],64)}}});export{Lt as default};
